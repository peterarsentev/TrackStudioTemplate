<div class="container-fluid pb-4">
  <div class="row pb-2">
    <span class="w-50">
      <ng-container *ngFor="let button of buttons">
        <button class="m btn btn-info btn-sm"
                (click)="goToComments(button)">{{ button.name }}</button>
      </ng-container>
    </span>
    <span class="w-50 pull-right">
      <button type="button" class="m btn btn-light btn-sm pull-right" *ngIf="previousAndNext.next"
              (click)="goTo(previousAndNext.next)">Следующая<i class="fas fa-angle-right pl-1"></i></button>
      <button type="button" class="m btn btn-light btn-sm pull-right" *ngIf="previousAndNext.previous"
              (click)="goTo(previousAndNext.previous)"><i class="fas fa-angle-left pr-1"></i>Предыдущая</button>
    </span>
  </div>
  <div class="row">
    <div class="w-100 card">
      <div class="card-header">
        <div class="grid">
          <div class="row">
            <div class="col-sm-10">
              <div class="">{{ task.string }}</div>
              <div>
                <small class="mb-2 text-muted">
                  <span *ngIf="status.start" class="badge badge-danger mr-3">{{ status.name }}</span>
                  <span *ngIf="status.finish" class="badge badge-success mr-3">{{ status.name }}</span>
                  <span *ngIf="!(status.finish || status.start)" class="badge badge-warning mr-3">{{ status.name }}</span>
                  <span *ngIf="handler" class="mr-3">Ответственный : {{handler.name }}</span>
                  <span class="mr-3">Создана : {{ task.submitdate | date: 'hh:mm dd.MM.yyyy' }}</span>
                  <span>Обновлена : {{  task.updatedate | date: 'hh:mm dd.MM.yyyy' }}</span>
                </small>
              </div>
            </div>
            <div class="pull-right col-sm-2">
              <i  class="fas fa-star pull-right"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="card-body">
        <p class="card-text" [innerHTML]="task.description | safeCode"></p>
      </div>
    </div>
  </div>
  <div class="row pb-2 pt-3">
    <span class="w-50" *ngIf="!showCommentForm">
      <ng-container *ngFor="let button of buttons">
        <button class="m btn btn-info btn-sm" (click)="goToComments(button)">{{ button.name }}</button>
      </ng-container>
    </span>
  </div>
  <div class="row" *ngIf="messages.length > 0">
    <div class="w-100 card">
      <div class="card-header">
        Сообщения
      </div>
      <div class="card-body">
        <table class="table">
          <tbody>
          <tr *ngFor="let message of messages"
              class="{{message.submitter.prstatusId === '4028816a5525e65b015525f8e0db007f' ? 'bg-light' : ''}}">
            <td>
              <div class="pb-3 small">
                <span>Oт <span class="font-weight-bold">{{ message.submitter.name }}</span> к <span class="font-weight-bold">{{ message.handler.name }}</span></span>
                <span class="pull-right">{{ message.message.time | getDate }}</span>
              </div>
              <div [innerHTML]="message.message.description | safeCode"></div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="row pt-2" *ngIf="messages.length > 0 && !showCommentForm">
   <span class="w-50">
      <ng-container *ngFor="let button of buttons">
        <button class="m btn btn-info btn-sm" (click)="goToComments(button)">{{ button.name }}</button>
      </ng-container>
    </span>
    <span class="w-50 pull-right">
      <button type="button" class="m btn btn-light btn-sm pull-right" *ngIf="previousAndNext.next"
              (click)="goTo(previousAndNext.next)">Следующая<i class="fas fa-angle-right pl-1"></i></button>
      <button type="button" class="m btn btn-light btn-sm pull-right" *ngIf="previousAndNext.previous"
              (click)="goTo(previousAndNext.previous)"><i class="fas fa-angle-left pr-1"></i>Предыдущая</button>
    </span>
  </div>
  <div class="row">
    <app-comments *ngIf="showCommentForm"
                  [mstatusId]="mstatusId"
                  [taskId]="task.id"
                  (save)="saveComment($event)"
    ></app-comments>
  </div>
</div>
